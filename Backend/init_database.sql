-- ============================================
-- 사자성어 학습 프로그램 데이터베이스 초기화 스크립트
-- MySQL 8.0
-- ============================================

-- 1. 데이터베이스 생성
DROP DATABASE IF EXISTS idiom_learning;
CREATE DATABASE idiom_learning CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
USE idiom_learning;

-- 2. Users 테이블 생성
CREATE TABLE Users (
    Id INT AUTO_INCREMENT PRIMARY KEY,
    Email VARCHAR(255) NOT NULL UNIQUE,
    Password VARCHAR(255) NOT NULL,
    Nickname VARCHAR(100) NOT NULL,
    ClearedStagesJson VARCHAR(500) NOT NULL DEFAULT '[]',
    LionStatsJson VARCHAR(500) NOT NULL DEFAULT '{"Hp":100,"MaxHp":100,"Level":1}',
    UnlockedContentJson VARCHAR(500) NOT NULL DEFAULT '{"HiddenBoss":false,"InfiniteMode":false,"PvpMode":false}',
    CreatedAt DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    LastLogin DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_email (Email)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- 3. Idioms 테이블 생성
CREATE TABLE Idioms (
    Id INT AUTO_INCREMENT PRIMARY KEY,
    IdiomId INT NOT NULL UNIQUE,
    Hanja VARCHAR(50) NOT NULL,
    Hangul VARCHAR(50) NOT NULL,
    Meaning VARCHAR(500) NOT NULL,
    ExampleSentence VARCHAR(500) NOT NULL,
    BaseDifficulty INT NOT NULL,
    Category VARCHAR(50) NOT NULL,
    CreatedAt DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_idiom_id (IdiomId),
    INDEX idx_difficulty (BaseDifficulty)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- 4. GameStages 테이블 생성
CREATE TABLE GameStages (
    Id INT AUTO_INCREMENT PRIMARY KEY,
    StageId INT NOT NULL UNIQUE,
    BossName VARCHAR(50) NOT NULL,
    Emoji VARCHAR(10) NOT NULL,
    ZodiacAnimal VARCHAR(50) NOT NULL,
    BossHp INT NOT NULL,
    BossAttackPower INT NOT NULL,
    BossImageUrl VARCHAR(255) NOT NULL,
    Description VARCHAR(255) NOT NULL,
    RequiredDifficulty INT NOT NULL,
    INDEX idx_stage_id (StageId)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- 5. LearningLogs 테이블 생성
CREATE TABLE LearningLogs (
    Id INT AUTO_INCREMENT PRIMARY KEY,
    UserId INT NOT NULL,
    StageId INT NULL,
    IdiomId INT NOT NULL,
    ActionType INT NOT NULL,
    ChosenDifficulty INT NULL,
    IsCorrect BOOLEAN NOT NULL,
    ResponseTimeMs INT NOT NULL,
    CalculatedDamage INT NOT NULL,
    Timestamp DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_user_id (UserId),
    INDEX idx_timestamp (Timestamp)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- 6. 사자성어 데이터 삽입
INSERT INTO Idioms (IdiomId, Hanja, Hangul, Meaning, ExampleSentence, BaseDifficulty, Category) VALUES
(1, '일석이조', '一石二鳥', '돌 하나를 던져 새 두 마리를 잡는다는 뜻으로, 한 가지 일을 하여 두 가지 이익을 얻음', '이번 여행은 관광도 하고 친구도 만나는 일석이조의 기회였다.', 0, '일상'),
(2, '이심전심', '以心傳心', '마음과 마음으로 서로 뜻이 통함', '우리는 이심전심으로 서로의 생각을 알아챘다.', 0, '인간관계'),
(3, '삼세번', '三思番', '세 번 생각하고 행동함', '중요한 결정은 삼세번 생각한 후에 하는 것이 좋다.', 0, '처세'),
(4, '사면초가', '四面楚歌', '사방이 모두 적에게 둘러싸여 고립된 상태', '회사는 경쟁사들에게 둘러싸여 사면초가에 처했다.', 0, '상황'),
(5, '오리무중', '五里霧中', '오 리나 되는 안개 속에 있다는 뜻으로, 무슨 일에 대하여 방향이나 갈피를 잡을 수 없음', '사건의 진상은 아직도 오리무중이다.', 0, '상황'),
(6, '유비무환', '有備無患', '미리 준비가 되어 있으면 걱정할 것이 없음', '유비무환이라고 항상 비상금을 준비해두었다.', 0, '처세'),
(7, '칠전팔기', '七顚八起', '일곱 번 넘어지고 여덟 번 일어난다는 뜻으로, 여러 번 실패해도 굴하지 않고 다시 일어남', '칠전팔기의 정신으로 끝까지 도전했다.', 0, '태도'),
(8, '팔방미인', '八方美人', '어떤 방면으로든 재주가 많고 뛰어난 사람', '그녀는 노래, 춤, 연기 모두 잘하는 팔방미인이다.', 0, '인물'),
(9, '구사일생', '九死一生', '아홉 번 죽을 뻔하다가 한 번 살아남. 죽을 고비를 여러 번 겪고 겨우 살아남', '큰 사고를 당했지만 구사일생으로 살아났다.', 0, '상황'),
(10, '십시일반', '十匙一飯', '열 사람이 한 숟가락씩 보태면 한 사람의 밥이 된다는 뜻으로, 여러 사람이 조금씩 힘을 합치면 한 사람을 돕기 쉬움', '십시일반으로 모금한 돈으로 이재민을 도왔다.', 0, '협력'),
(11, '백문불여일견', '百聞不如一見', '백 번 듣는 것이 한 번 보는 것만 못함', '백문불여일견이라고 직접 가서 보는 것이 낫다.', 0, '교훈'),
(12, '천리안', '千里眼', '천 리 밖의 것까지 본다는 뜻으로, 사물을 꿰뚫어 보는 능력이 뛰어남', '그는 천리안을 가진 것처럼 미래를 예측했다.', 0, '능력'),
(13, '만사형통', '萬事亨通', '모든 일이 뜻대로 잘 됨', '새해에는 만사형통하시길 기원합니다.', 0, '축복'),
(14, '억만금', '億萬金', '매우 많은 재물', '건강은 억만금을 주고도 살 수 없다.', 0, '재물'),
(15, '조삼모사', '朝三暮四', '간사한 꾀로 남을 속여 희롱함', '그의 말은 조삼모사로 믿을 수 없다.', 0, '처세'),
(16, '백발백중', '百發百中', '백 번 쏘아 백 번 맞춘다는 뜻으로, 모든 일이 예상대로 들어맞음', '그의 예측은 항상 백발백중이다.', 0, '능력'),
(17, '동문서답', '東問西答', '동쪽을 물으니 서쪽을 대답한다는 뜻으로, 질문과 대답이 서로 맞지 않음', '그의 대답은 동문서답으로 핵심을 벗어났다.', 0, '대화'),
(18, '좌우명', '座右銘', '늘 자신의 좌우에 두고 경계하거나 본보기로 삼는 글귀', '나의 좌우명은 최선을 다하라이다.', 0, '교훈'),
(19, '사생결단', '死生決斷', '죽고 사는 것을 돌보지 않고 결단을 내림', '사생결단의 각오로 이 일에 임하겠다.', 0, '태도'),
(20, '우왕좌왕', '右往左往', '갈팡질팡하며 어찌할 바를 모름', '갑작스러운 상황에 사람들이 우왕좌왕했다.', 0, '행동'),
(21, '견물생심', '見物生心', '물건을 보면 욕심이 생김', '백화점에 가면 견물생심으로 지갑이 열린다.', 1, '심리'),
(22, '각주구검', '刻舟求劍', '배에 표시하고 검을 찾는다는 뜻으로, 융통성 없이 고지식함', '시대가 변했는데 각주구검 식으로 대응해서는 안 된다.', 1, '처세'),
(23, '감언이설', '甘言利說', '남의 비위를 맞추거나 이롭게 하기 위한 달콤한 말과 그럴듯한 말', '감언이설에 속아서는 안 된다.', 1, '언어'),
(24, '개과천선', '改過遷善', '지난 잘못을 고치고 착하게 됨', '그는 개과천선하여 새 사람이 되었다.', 1, '변화'),
(25, '고군분투', '孤軍奮鬪', '도와주는 사람 없이 혼자 힘으로 어려움과 싸움', '그는 고군분투하며 사업을 일으켰다.', 1, '노력'),
(26, '교언영색', '巧言令色', '교묘하게 꾸민 말과 알랑거리는 태도', '교언영색으로 사람을 현혹시키는 자를 조심해야 한다.', 1, '인물'),
(27, '권토중래', '捲土重來', '한 번 실패한 자가 힘을 회복하여 다시 쳐들어옴', '이번 패배는 일시적일 뿐, 권토중래를 준비하겠다.', 1, '재도전'),
(28, '금상첨화', '錦上添花', '비단 위에 꽃을 더한다는 뜻으로, 좋은 일 위에 또 좋은 일이 더하여짐', '승진에 이어 결혼까지 하니 금상첨화다.', 1, '경사'),
(29, '낙화유수', '落花流水', '떨어지는 꽃과 흐르는 물이라는 뜻으로, 남녀가 서로 그리워하는 정', '그 둘은 낙화유수의 정으로 결혼했다.', 1, '사랑'),
(30, '동고동락', '同苦同樂', '괴로움과 즐거움을 함께함', '우리는 동고동락하며 사업을 일구어왔다.', 1, '우정'),
(31, '마이동풍', '馬耳東風', '말의 귀에 동풍이라는 뜻으로, 남의 말을 귀담아듣지 않고 흘려버림', '아무리 충고해도 마이동풍으로 듣고 흘린다.', 1, '태도'),
(32, '망연자실', '茫然自失', '정신이 아득하여 어찌할 바를 모름', '충격적인 소식에 망연자실했다.', 1, '감정'),
(33, '명불허전', '名不虛傳', '이름난 것이 헛되지 않음. 명성이나 명예가 이유 없이 생긴 것이 아님', '명불허전이라더니 정말 실력이 대단하다.', 1, '평가'),
(34, '무아지경', '無我之境', '자기를 잊어버린 경지. 어떤 일에 정신이 온통 쏠려 다른 것을 의식하지 못하는 상태', '그는 무아지경에 빠져 그림을 그렸다.', 1, '집중'),
(35, '배은망덕', '背恩忘德', '남에게 입은 은혜를 저버리고 배신함', '배은망덕한 행동으로 신뢰를 잃었다.', 1, '도덕'),
(36, '부화뇌동', '附和雷同', '자기의 주관 없이 남의 의견에 따라 움직임', '부화뇌동하지 말고 자기 생각을 가져라.', 1, '태도'),
(37, '불철주야', '不撤晝夜', '밤낮을 가리지 않고 쉬지 않음', '불철주야 일한 덕분에 사업이 성공했다.', 1, '노력'),
(38, '설상가상', '雪上加霜', '눈 위에 서리가 덮인다는 뜻으로, 난처한 일이나 불행이 잇따라 일어남', '사고를 당했는데 설상가상으로 비까지 내렸다.', 1, '불운'),
(39, '심기일전', '心機一轉', '어떤 계기로 마음을 완전히 바꿔먹음', '실패 후 심기일전하여 다시 도전했다.', 1, '변화'),
(40, '안하무인', '眼下無人', '눈 아래 사람이 없다는 뜻으로, 방자하고 교만하여 다른 사람을 업신여김', '그의 안하무인한 태도가 사람들을 불쾌하게 했다.', 1, '태도'),
(41, '갑론을박', '甲論乙駁', '서로 자기주장을 내세우며 논쟁함', '회의에서 갑론을박 끝에 결론을 내렸다.', 2, '토론'),
(42, '과유불급', '過猶不及', '지나친 것은 미치지 못한 것과 같음', '과유불급이라고 적당히 하는 것이 좋다.', 2, '교훈'),
(43, '교토삼굴', '狡兎三窟', '교활한 토끼는 굴을 세 개 판다는 뜻으로, 미리 여러 가지 방법을 준비해 둠', '교토삼굴처럼 여러 가지 대책을 마련했다.', 2, '전략'),
(44, '구밀복검', '口蜜腹劍', '입에는 꿀이 있고 배에는 칼이 있다는 뜻으로, 말로는 친한 척하면서 속으로는 해칠 생각을 품음', '그는 구밀복검으로 사람들을 속였다.', 2, '음흉'),
(45, '군계일학', '群鷄一鶴', '닭의 무리 가운데 한 마리의 학이라는 뜻으로, 많은 사람 가운데 뛰어난 인물', '그는 군계일학으로 모두의 주목을 받았다.', 2, '탁월'),
(46, '금의환향', '錦衣還鄕', '비단옷을 입고 고향에 돌아간다는 뜻으로, 출세하여 고향에 돌아감', '그는 금의환향하여 고향 사람들을 기쁘게 했다.', 2, '성공'),
(47, '노심초사', '勞心焦思', '몹시 마음을 쓰며 애를 태움', '자녀 걱정에 노심초사하는 부모의 마음.', 2, '근심'),
(48, '다다익선', '多多益善', '많으면 많을수록 더욱 좋음', '친구는 다다익선이다.', 2, '양'),
(49, '대기만성', '大器晩成', '큰 그릇을 만드는 데는 시간이 오래 걸린다는 뜻으로, 크게 될 사람은 늦게 이루어짐', '대기만성형 인재로 늦깎이 성공을 거뒀다.', 2, '성공'),
(50, '독야청청', '獨也靑靑', '홀로 푸르다는 뜻으로, 어려움 속에서도 혼자 절개를 지킴', '어려운 시절에도 독야청청 지조를 지켰다.', 2, '절개'),
(51, '동병상련', '同病相憐', '같은 병을 앓는 사람끼리 서로 가엾게 여긴다는 뜻으로, 어려운 처지에 있는 사람끼리 서로 동정하고 도움', '동병상련으로 서로 위로하며 힘든 시기를 견뎠다.', 2, '동정'),
(52, '막역지우', '莫逆之友', '서로 거스름이 없는 친구라는 뜻으로, 허물없이 아주 친한 벗', '우리는 막역지우로 평생을 함께했다.', 2, '우정'),
(53, '문전성시', '門前成市', '문 앞에 시장을 이룬다는 뜻으로, 찾아오는 사람이 매우 많음', '그 식당은 문전성시를 이루고 있다.', 2, '번영'),
(54, '백면서생', '白面書生', '흰 얼굴의 글만 읽는 선비라는 뜻으로, 세상 물정을 모르는 사람', '백면서생처럼 세상 일에 어두워서는 안 된다.', 2, '인물'),
(55, '반포지효', '反哺之孝', '까마귀가 자라서 늙은 어미에게 먹이를 물어다 준다는 뜻으로, 자식이 자라서 어버이의 은혜를 갚음', '반포지효의 마음으로 부모님을 모셨다.', 2, '효도'),
(56, '삼고초려', '三顧草廬', '초가집을 세 번 찾아간다는 뜻으로, 인재를 맞아들이기 위해 참을성 있게 노력함', '삼고초려 끝에 그를 영입했다.', 2, '노력'),
(57, '새옹지마', '塞翁之馬', '인생의 길흉화복은 변화가 많아서 예측하기 어려움', '새옹지마라고 좋은 일이 나쁜 일이 될 수도 있다.', 2, '운명'),
(58, '수어지교', '水魚之交', '물과 물고기의 사귐이라는 뜻으로, 떨어질 수 없는 매우 친밀한 사이', '우리는 수어지교의 관계다.', 2, '우정'),
(59, '역지사지', '易地思之', '처지를 바꾸어 생각해 봄', '역지사지로 상대방 입장을 생각해야 한다.', 2, '배려'),
(60, '와신상담', '臥薪嘗膽', '섶 위에 누워 자고 쓸개를 맛본다는 뜻으로, 원수를 갚거나 목적을 이루기 위해 온갖 괴로움을 참고 견딤', '와신상담하며 복수를 준비했다.', 2, '복수'),
(61, '청출어람', '靑出於藍', '쪽에서 나온 푸른빛이 쪽보다 더 푸르다는 뜻으로, 제자가 스승보다 나음', '제자가 청출어람하여 스승을 뛰어넘었다.', 2, '성장'),
(62, '동상이몽', '同床異夢', '같은 자리에 자면서 다른 꿈을 꾼다는 뜻으로, 겉으로는 같이 행동하면서 속으로는 각각 다른 생각을 함', '두 사람은 동상이몽으로 결국 결별했다.', 1, '불화'),
(63, '호가호위', '狐假虎威', '여우가 호랑이의 위세를 빌린다는 뜻으로, 남의 권세를 빌려 위세를 부림', '호가호위로 권력을 남용하는 사람.', 2, '권력'),
(64, '화룡점정', '畫龍點睛', '용을 그리고 마지막으로 눈동자를 그려 넣는다는 뜻으로, 가장 요긴한 부분을 완성하여 일을 끝맺음', '화룡점정으로 완벽한 작품을 완성했다.', 2, '완성'),
(65, '환골탈태', '換骨奪胎', '뼈를 바꾸고 태를 벗긴다는 뜻으로, 완전히 새롭게 변화함', '환골탈태하여 전혀 다른 사람이 되었다.', 2, '변화'),
(66, '흥진비래', '興盡悲來', '즐거움이 다하면 슬픔이 온다는 뜻으로, 좋은 일이 지나가면 슬픈 일이 생김', '흥진비래라고 파티 후에 허전함이 밀려왔다.', 2, '감정'),
(67, '타산지석', '他山之石', '다른 산의 돌이라는 뜻으로, 다른 사람의 하찮은 언행도 자신의 지식과 인격을 수양하는 데 도움이 됨', '타산지석으로 삼아 같은 실수를 반복하지 말자.', 2, '교훈'),
(68, '파죽지세', '破竹之勢', '대나무를 쪼개는 기세라는 뜻으로, 거침없이 빠르게 진행하는 기세', '팀은 파죽지세로 우승을 향해 나아갔다.', 2, '기세'),
(69, '함흥차사', '咸興差使', '함흥에 간 사신이라는 뜻으로, 한 번 가면 소식이 없거나 돌아오지 않음', '빌린 돈은 함흥차사가 되었다.', 2, '소식'),
(70, '허심탄회', '虛心坦懷', '마음을 비우고 솔직하게 터놓음', '허심탄회하게 의견을 나누었다.', 2, '대화');

-- 7. 게임 스테이지 데이터 삽입
INSERT INTO GameStages (StageId, BossName, Emoji, ZodiacAnimal, BossHp, BossAttackPower, BossImageUrl, Description, RequiredDifficulty) VALUES
(1, '토끼', '🐰', '토끼', 100, 10, '/pictures/rabbit.png', '평화로운 토끼, 여정의 시작', 0),
(2, '양', '🐑', '양', 120, 12, '/pictures/sheep.png', '온순한 양, 따뜻한 시험', 0),
(3, '원숭이', '🐵', '원숭이', 140, 14, '/pictures/monkey.png', '영리한 원숭이, 지혜의 도전', 0),
(4, '쥐', '🐭', '쥐', 160, 16, '/pictures/mouse.png', '민첩한 쥐, 초급의 마지막 관문', 0),
(5, '돼지', '🐷', '돼지', 180, 18, '/pictures/pig.png', '강건한 돼지, 중급의 시작', 1),
(6, '개', '🐶', '개', 200, 20, '/pictures/dog.png', '충직한 개, 충성의 시험', 1),
(7, '소', '🐮', '소', 220, 22, '/pictures/bull.png', '우직한 소, 인내의 벽', 1),
(8, '뱀', '🐍', '뱀', 240, 24, '/pictures/snake.png', '신비로운 뱀, 중급의 마지막 시련', 1),
(9, '말', '🐴', '말', 260, 26, '/pictures/horse.png', '질주하는 말, 고급의 서막', 2),
(10, '봉황', '🐔', '닭', 280, 28, '/pictures/chicken.png', '불사조 봉황, 불꽃의 심판', 2),
(11, '용', '🐲', '용', 300, 30, '/pictures/dragon.png', '천상의 용, 하늘의 지배자', 2),
(12, '호랑이', '🐯', '호랑이', 500, 35, '/pictures/tiger.png', '백수의 왕 호랑이, 최종 보스', 2);

-- 8. 데이터 확인
SELECT '사자성어 데이터:' as Info, COUNT(*) as Count FROM Idioms
UNION ALL
SELECT '스테이지 데이터:', COUNT(*) FROM GameStages;

SELECT 'EASY 사자성어:', COUNT(*) FROM Idioms WHERE BaseDifficulty = 0
UNION ALL
SELECT 'MEDIUM 사자성어:', COUNT(*) FROM Idioms WHERE BaseDifficulty = 1
UNION ALL
SELECT 'HARD 사자성어:', COUNT(*) FROM Idioms WHERE BaseDifficulty = 2;

-- ============================================
-- 완료!
-- ============================================
